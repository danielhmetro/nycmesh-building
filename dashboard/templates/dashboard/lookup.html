<!DOCTYPE html>
<html>
<head>
    <title>Lookup</title>
</head>
<body>
    <h1>Lookup</h1>
    <form method="post">
        {% csrf_token %}
        {{ form.query }}
        <button type="submit">Search</button>
    </form>

    {% if error_message %}
        <p style="color: red;">{{ error_message }}</p>
    {% endif %}

    {% if results and not selected_member_info %}
        <h2>Select a Member</h2>
        <form method="post">
            {% csrf_token %}
            {{ form.selected_member }}
            <button type="submit">Select</button>
        </form>
    {% endif %}

    {% if selected_member_info %}
        <h2>Selected Member Details</h2>
        <p>Install Number: #{{ selected_member_info.installs.0 }}</p>
        <p>Name: {{ selected_member_info.name }}</p>
        <p>Number: {{ selected_member_info.phone_number }}</p>
        <p>Email: {{ selected_member_info.primary_email_address }}</p>
        <p>Unit: {{ selected_member_info.unit }}</p>
    {% endif %}

    {% if device_info %}
        <h2>Device Information</h2>
        <p><strong>Name:</strong> {{ device_info.name }}</p>
        <p><strong>Status:</strong> {{ device_info.status }}</p>
        <p><strong>Signal:</strong> {{ device_info.signal }}</p>
        <p><strong>Last Seen:</strong> {{ device_info.lastSeen }}</p>
        <p><strong>Model:</strong> {{ device_info.model }}</p>
        <p><strong>2.4 GHz SSID:</strong> {{ device_info.ssid1 }}</p>
        <p><strong>2.4 GHz Password:</strong> {{ device_info.password1 }}</p>
        <p><strong>5 GHz SSID:</strong> {{ device_info.ssid2 }}</p>
        <p><strong>5 GHz Password:</strong> {{ device_info.password2 }}</p>
    {% endif %}

    {% if subscription_info %}
        <h2>Subscription Information</h2>
        <p><strong>Nickname:</strong> {{ subscription_info.nickname }}</p>
        <p><strong>Status:</strong> {{ subscription_info.status }}</p>
        <p><strong>Delinquent:</strong> {{ selected_member_info.delinquent }}</p>
        <p><strong>Current Period Start:</strong> {{ subscription_info.current_period_start }}</p>
        <p><strong>Current Period End:</strong> {{ subscription_info.current_period_end }}</p>
        <p><strong>Last Paid:</strong> {{ subscription_info.last_paid }}</p>
    {% endif %}

    {% if selected_member_info.ninja_invoices %}
        <h2>Ninja Invoices</h2>
        <table>
            <thead>
                <tr>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Reminder 1 Sent</th>
                    <th>Reminder 2 Sent</th>
                    <th>Reminder 3 Sent</th>
                    <th>Next Send Date</th>
                </tr>
            </thead>
            <tbody>
                {% for invoice in selected_member_info.ninja_invoices %}
                    <tr>
                        <td>{{ invoice.amount }}</td>
                        <td>{{ invoice.date }}</td>
                        <td>{{ invoice.reminder1_sent }}</td>
                        <td>{{ invoice.reminder2_sent }}</td>
                        <td>{{ invoice.reminder3_sent }}</td>
                        <td>{{ invoice.next_send_date }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</body>
</html>